"use strict";var myScroll;$(function(){myScroll=new IScroll("#scroll",{mouseWheel:!0,scrollbars:!0});var t=localStorage.getItem("zxwUserID");if(null!=t||t)!function(t){$.ajax({type:"get",url:"http://datainfo.duapp.com/shopdata/getCar.php",dataType:"jsonp",data:{userID:t},success:function(a){console.log(a);var o=0,s=0;if(a.length)$.each(a,function(t){var n=a[t].goodsName.slice(0,24),i=a[t].price,e=a[t].number,d=a[t].goodsListImg,l=a[t].goodsID;o+=e*i,s+=1;var r=$("<li id='"+l+"'></li>"),c=$("<div class='img'>加载中...</div>"),p=$("<img src='"+d+"' />");p.on("load",function(){c.empty(),c.append(p)});var u=$("<div class='text'></div>");u[0].innerHTML='<div class="title-box">\n\t\t\t\t\t\t\t\t\t<p class="title">'+n+'</p>\n\t\t\t\t\t\t\t\t\t<b class="SC_deleteGoodsBtn" data-goodsid="'+l+'" data-goodsPrice ="'+i+'" data-goodsNum="'+e+'"></b>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="info">\n\t\t\t\t\t\t\t\t\t<p class="a-price">单价：<span>￥'+i+'</span></p>\n\t\t\t\t\t\t\t\t\t<span class="size">L</span>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="num">\n\t\t\t\t\t\t\t\t\t<span>数量：</span>\n\t\t\t\t\t\t\t\t\t<div class="chang-num" data-goodsid="'+l+'" data-goodsPrice ="'+i+'" data-goodsNum="'+e+'">\n\t\t\t\t\t\t\t\t\t\t<b class="add">-</b>\n\t\t\t\t\t\t\t\t\t\t<input type="number" value="'+e+'"  />\n\t\t\t\t\t\t\t\t\t\t<b class="differ">+</b>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>',r.append(c),r.append(u),$("#SC_goodsList").append(r),myScroll.refresh(),p.on("touchstart",function(){window.location.href="18goodsproduct.html?goodsID="+encodeURI(a[t].goodsID)})}),$("#totalPrice").text(o),$("#SC_totalNum").text(s),$(".SC_deleteGoodsBtn").on("touchstart",function(){console.log("删除",$(this).attr("data-goodsid"));var a=$(this).attr("data-goodsid");$.ajax({type:"post",url:"http://datainfo.duapp.com/shopdata/updatecar.php",data:{userID:t,goodsID:a,number:0},success:function(t){t?(alert("删除商品成功"),console.log($(this).parents("li")),$(this).parents("li").remove(),console.log($(this).attr("data-goodsPrice")*$(this).attr("data-goodsNum")),o-=$(this).attr("data-goodsPrice")*$(this).attr("data-goodsNum"),$("#totalPrice").text(o)):alert("删除商品失败")}.bind(this)})}),$(".differ").on("touchstart",function(){console.log("+"),console.log($(this).parent().attr("data-goodsid")),console.log(parseInt($(this).siblings("input").val())+1);var a=$(this).parent().attr("data-goodsid"),s=parseInt($(this).siblings("input").val())+1;$.ajax({type:"post",url:"http://datainfo.duapp.com/shopdata/updatecar.php",data:{userID:t,goodsID:a,number:s},success:function(t){t?(console.log("添加购物车成功"),$(this).siblings("input").val(s),o+=parseFloat($(this).parent().attr("data-goodsPrice")),$("#totalPrice").text(o)):alert("添加购物车失败")}.bind(this)})}),$(".add").on("touchstart",function(){console.log("-");var a=$(this).parent().attr("data-goodsid"),s=parseInt($(this).siblings("input").val())-1;0===s?alert("不能再减少了哦！"):$.ajax({type:"post",url:"http://datainfo.duapp.com/shopdata/updatecar.php",data:{userID:t,goodsID:a,number:s},success:function(t){t?(console.log("更新成功"),$(this).siblings("input").val(s),o-=$(this).parent().attr("data-goodsPrice"),$("#totalPrice").text(o)):alert("操作购物车失败")}.bind(this)})});else{var n=$("<div class='no-goods'></div>");n[0].innerHTML='<div class="pic">\n\t\t\t\t\t\t\t\t\t\t\t<p>您的购物车空空~~</p>\n\t\t\t\t\t\t\t\t\t\t\t<div class="img"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<p class="btn-go" id="btn-go">\n\t\t\t\t\t\t\t\t\t\t\t去逛逛\n\t\t\t\t\t\t\t\t\t\t</p>',$("#scroll").empty(),$("#scroll").append(n),$("#btn-go").on("touchstart",function(){window.location.href="index.html"})}}})}(t);else{$("#scroll").empty();var a=$('<p style="font-size:0.4rem;margin:1.5rem 0;text-align:center">亲您还没有登陆哦~</p>'),o=$('<a style="font-size:0.5rem;margin:0 auto;display:block;background:#fff;border:1px solid #aaa;width:1.8rem;text-align:center;border-radius:0.1rem">去登录</a>');$("#scroll").append(a),$("#scroll").append(o),o.on("touchstart",function(){window.location.href="login.html"})}});